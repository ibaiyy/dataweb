import{d as B,a as m,k as S,r as n,o as _,c as w,B as r,A as t,D as p,N as c,g as $,L as D,M as A,E as H,H as K}from"./vlib-DOiUgBZ7.js";import{b as f,i as O,d as j,_ as z}from"./index-DVgET6nB.js";import"./quill-BosuxZz1.js";import"./lodash-DNhsom2x.js";const T=B({__name:"user-add-or-update",emits:["refreshDataList"],setup(G,{expose:I,emit:L}){const N=L,i=m(!1),g=m([]),u=m(),l=S({id:"",username:"",deptId:"",deptName:"",password:"",confirmPassword:"",realName:"",gender:0,email:"",mobile:"",roleIdList:[],highRoleIdList:[],status:1}),U=m({username:[{required:!0,message:"必填项不能为空",trigger:"blur"}],deptName:[{required:!0,message:"必填项不能为空",trigger:"change"}],password:[{validator:(s,e,a)=>{if(!l.id&&!/\S/.test(e))return a(new Error("必填项不能为空"));a()},trigger:"blur"}],confirmPassword:[{validator:(s,e,a)=>{if(!l.id&&!/\S/.test(e))return a(new Error("必填项不能为空"));if(l.password!==e)return a(new Error("确认密码与密码输入不一致"));a()},trigger:"blur"}],realName:[{required:!0,message:"必填项不能为空",trigger:"blur"}],email:[{validator:(s,e,a)=>{if(e&&!O(e))return a(new Error("邮箱格式错误"));a()},trigger:"blur"}],mobile:[{validator:(s,e,a)=>{if(e&&!j(e))return a(new Error("手机格式错误"));a()},trigger:"blur"}]}),y=s=>{i.value=!0,l.id="",l.deptId="",u.value&&u.value.resetFields(),Promise.all([E()]).then(()=>{s&&P(s)})},E=()=>f.get("/sys/role/list").then(s=>{g.value=s.data}),P=s=>{f.get(`/sys/user/${s}`).then(e=>{Object.assign(l,e.data),l.highRoleIdList=l.roleIdList.filter(a=>!g.value.some(d=>d.id===a)),l.roleIdList=l.roleIdList.filter(a=>!l.highRoleIdList.includes(a))})},V=()=>{u.value.validate(s=>{if(!s)return!1;(l.id?f.put:f.post)("/sys/user",{...l,roleIdList:[...l.roleIdList,...l.highRoleIdList]}).then(e=>{K.success({message:"成功",duration:500,onClose:()=>{i.value=!1,N("refreshDataList")}})})})};return I({init:y}),(s,e)=>{const a=n("el-input"),d=n("el-form-item"),C=n("ren-dept-tree"),x=n("ren-radio-group"),R=n("el-option"),F=n("el-select"),b=n("el-radio"),q=n("el-radio-group"),M=n("el-form"),v=n("el-button"),k=n("el-dialog");return _(),w(k,{modelValue:i.value,"onUpdate:modelValue":e[14]||(e[14]=o=>i.value=o),title:l.id?"修改":"新增","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:r(()=>[t(v,{onClick:e[12]||(e[12]=o=>i.value=!1)},{default:r(()=>[p("取消")]),_:1}),t(v,{type:"primary",onClick:e[13]||(e[13]=o=>V())},{default:r(()=>[p("确定")]),_:1})]),default:r(()=>[t(M,{model:l,rules:U.value,ref_key:"dataFormRef",ref:u,onKeyup:e[11]||(e[11]=H(o=>V(),["enter"])),"label-width":"120px"},{default:r(()=>[t(d,{prop:"username",label:"用户名"},{default:r(()=>[t(a,{modelValue:l.username,"onUpdate:modelValue":e[0]||(e[0]=o=>l.username=o),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),t(d,{prop:"deptName",label:"所属部门"},{default:r(()=>[t(C,{modelValue:l.deptId,"onUpdate:modelValue":e[1]||(e[1]=o=>l.deptId=o),placeholder:"选择部门",deptName:l.deptName,"onUpdate:deptName":e[2]||(e[2]=o=>l.deptName=o)},null,8,["modelValue","deptName"])]),_:1}),t(d,{prop:"password",label:"密码",class:c({"is-required":!l.id})},{default:r(()=>[t(a,{modelValue:l.password,"onUpdate:modelValue":e[3]||(e[3]=o=>l.password=o),type:"password",placeholder:"密码"},null,8,["modelValue"])]),_:1},8,["class"]),t(d,{prop:"confirmPassword",label:"确认密码",class:c({"is-required":!l.id})},{default:r(()=>[t(a,{modelValue:l.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=o=>l.confirmPassword=o),type:"password",placeholder:"确认密码"},null,8,["modelValue"])]),_:1},8,["class"]),t(d,{prop:"realName",label:"真实姓名"},{default:r(()=>[t(a,{modelValue:l.realName,"onUpdate:modelValue":e[5]||(e[5]=o=>l.realName=o),placeholder:"真实姓名"},null,8,["modelValue"])]),_:1}),t(d,{prop:"gender",label:"性别"},{default:r(()=>[t(x,{modelValue:l.gender,"onUpdate:modelValue":e[6]||(e[6]=o=>l.gender=o),"dict-type":"gender"},null,8,["modelValue"])]),_:1}),t(d,{prop:"email",label:"邮箱"},{default:r(()=>[t(a,{modelValue:l.email,"onUpdate:modelValue":e[7]||(e[7]=o=>l.email=o),placeholder:"邮箱"},null,8,["modelValue"])]),_:1}),t(d,{prop:"mobile",label:"手机号"},{default:r(()=>[t(a,{modelValue:l.mobile,"onUpdate:modelValue":e[8]||(e[8]=o=>l.mobile=o),placeholder:"手机号"},null,8,["modelValue"])]),_:1}),t(d,{prop:"roleIdList",label:"角色配置",class:"role-list"},{default:r(()=>[t(F,{modelValue:l.roleIdList,"onUpdate:modelValue":e[9]||(e[9]=o=>l.roleIdList=o),multiple:"",placeholder:"角色配置"},{default:r(()=>[(_(!0),$(A,null,D(g.value,o=>(_(),w(R,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{prop:"status",label:"状态"},{default:r(()=>[t(q,{modelValue:l.status,"onUpdate:modelValue":e[10]||(e[10]=o=>l.status=o)},{default:r(()=>[t(b,{label:0},{default:r(()=>[p("停用")]),_:1}),t(b,{label:1},{default:r(()=>[p("正常")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),le=z(T,[["__scopeId","data-v-3c6cb571"]]);export{le as default};
