import{d as G,a as u,k as J,r as s,o as i,c as m,B as o,A as n,D as c,Z as Q,K as v,h as y,g as S,L as W,M as X,E as Y,H as ee,N as le}from"./vlib-DOiUgBZ7.js";import{c as $,b as g}from"./index-DVgET6nB.js";const oe={class:"popover-pop-body"},te={class:"mod-sys__menu-icon-inner"},ne={class:"mod-sys__menu-icon-list"},ae={class:"icon-svg","aria-hidden":"true"},se=["xlink:href"],pe=G({__name:"menu-add-or-update",emits:["refreshDataList"],setup(re,{expose:B,emit:H}){const w=H,d=u(!1),k=u([]),V=u([]),p=u(),C=u(),L=u(),N=u(),e=J({id:"",menuType:0,name:"",pid:"0",parentName:"",url:"",permissions:"",sort:0,icon:"",openStyle:0}),D=u({name:[{required:!0,message:"必填项不能为空",trigger:"blur"}],parentName:[{required:!0,message:"必填项不能为空",trigger:"change"}]}),K=a=>{d.value=!0,e.id="",p.value&&p.value.resetFields(),V.value=$(),e.pid="0",e.parentName="一级菜单",h().then(()=>{a&&P(a)})},M=a=>{d.value=!0,p.value&&p.value.resetFields(),V.value=$(),e.id="",e.pid=a.id,e.parentName=a.name,h()},h=()=>g.get("/sys/menu/list?type=0").then(a=>{k.value=a.data}),P=a=>{g.get(`/sys/menu/${a}`).then(l=>{if(Object.assign(e,l.data),e.pid==="0")return T();C.value.setCurrentKey(e.pid)})},T=()=>{e.pid="0",e.parentName="一级菜单"},E=a=>{e.pid=a.id,e.parentName=a.name,L.value.hide()},q=a=>{e.icon=a,N.value.hide()},x=()=>{p.value.validate(a=>{if(!a)return!1;(e.id?g.put:g.post)("/sys/menu",e).then(l=>{ee.success({message:"成功",duration:500,onClose:()=>{d.value=!1,w("refreshDataList")}})})})};return B({init:K,init2:M}),(a,l)=>{const f=s("el-radio"),U=s("el-radio-group"),r=s("el-form-item"),_=s("el-input"),I=s("circle-close"),R=s("el-icon"),j=s("el-tree"),F=s("el-popover"),z=s("el-input-number"),b=s("el-button"),A=s("el-form"),O=s("el-dialog");return i(),m(O,{modelValue:d.value,"onUpdate:modelValue":l[12]||(l[12]=t=>d.value=t),title:e.id?"修改":"新增","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:o(()=>[n(b,{onClick:l[10]||(l[10]=t=>d.value=!1)},{default:o(()=>[c("取消")]),_:1}),n(b,{type:"primary",onClick:l[11]||(l[11]=t=>x())},{default:o(()=>[c("确定")]),_:1})]),default:o(()=>[n(A,{model:e,rules:D.value,ref_key:"dataFormRef",ref:p,onKeyup:l[9]||(l[9]=Y(t=>x(),["enter"])),"label-width":"120px"},{default:o(()=>[n(r,{prop:"menuType",label:"类型"},{default:o(()=>[n(U,{modelValue:e.menuType,"onUpdate:modelValue":l[0]||(l[0]=t=>e.menuType=t),disabled:!!e.id},{default:o(()=>[n(f,{label:0},{default:o(()=>[c("菜单")]),_:1}),n(f,{label:1},{default:o(()=>[c("按钮")]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),n(r,{prop:"name",label:"名称"},{default:o(()=>[n(_,{modelValue:e.name,"onUpdate:modelValue":l[1]||(l[1]=t=>e.name=t),placeholder:"名称"},null,8,["modelValue"])]),_:1}),n(r,{prop:"parentName",label:"上级菜单",class:"menu-list"},{default:o(()=>[n(F,{ref_key:"menuListPopover",ref:L,placement:"bottom-start",trigger:"click",width:400,"popper-class":"popover-pop"},{reference:o(()=>[n(_,{modelValue:e.parentName,"onUpdate:modelValue":l[3]||(l[3]=t=>e.parentName=t),readonly:!0,placeholder:"上级菜单"},{suffix:o(()=>[e.pid!=="0"?(i(),m(R,{key:0,onClick:l[2]||(l[2]=Q(t=>T(),["stop"])),class:"el-input__icon"},{default:o(()=>[n(I)]),_:1})):v("",!0)]),_:1},8,["modelValue"])]),default:o(()=>[y("div",oe,[n(j,{data:k.value,props:{label:"name",children:"children"},"node-key":"id",ref_key:"menuListTree",ref:C,"highlight-current":!0,"expand-on-click-node":!1,accordion:"",onCurrentChange:E},null,8,["data"])])]),_:1},512)]),_:1}),e.menuType===0?(i(),m(r,{key:0,prop:"url",label:"路由"},{default:o(()=>[n(_,{modelValue:e.url,"onUpdate:modelValue":l[4]||(l[4]=t=>e.url=t),placeholder:"路由"},null,8,["modelValue"])]),_:1})):v("",!0),n(r,{prop:"sort",label:"排序"},{default:o(()=>[n(z,{modelValue:e.sort,"onUpdate:modelValue":l[5]||(l[5]=t=>e.sort=t),"controls-position":"right",min:0,label:"排序"},null,8,["modelValue"])]),_:1}),e.menuType===0?(i(),m(r,{key:1,prop:"openStyle",label:"打开方式"},{default:o(()=>[n(U,{modelValue:e.openStyle,"onUpdate:modelValue":l[6]||(l[6]=t=>e.openStyle=t)},{default:o(()=>[n(f,{label:0},{default:o(()=>[c("内部打开")]),_:1}),n(f,{label:1},{default:o(()=>[c("外部打开")]),_:1})]),_:1},8,["modelValue"])]),_:1})):v("",!0),n(r,{prop:"permissions",label:"授权标识"},{default:o(()=>[n(_,{modelValue:e.permissions,"onUpdate:modelValue":l[7]||(l[7]=t=>e.permissions=t),placeholder:"多个用逗号分隔，如：sys:menu:save,sys:menu:update"},null,8,["modelValue"])]),_:1}),e.menuType===0?(i(),m(r,{key:2,prop:"icon",label:"图标",class:"icon-list"},{default:o(()=>[n(F,{ref_key:"iconListPopover",ref:N,placement:"top-start",trigger:"click","popper-class":"popover-pop mod-sys__menu-icon-popover"},{reference:o(()=>[n(_,{modelValue:e.icon,"onUpdate:modelValue":l[8]||(l[8]=t=>e.icon=t),readonly:!0,placeholder:"图标"},null,8,["modelValue"])]),default:o(()=>[y("div",te,[y("div",ne,[(i(!0),S(X,null,W(V.value,(t,Z)=>(i(),m(b,{key:Z,onClick:ue=>q(t),class:le({"is-active":e.icon===t})},{default:o(()=>[(i(),S("svg",ae,[y("use",{"xlink:href":`#${t}`},null,8,se)]))]),_:2},1032,["onClick","class"]))),128))])])]),_:1},512)]),_:1})):v("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});export{pe as _};
