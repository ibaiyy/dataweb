import{d as N,a as x,k as $,x as T,r as m,e as V,o as l,g as U,A as n,B as a,D as i,c as r,K as u,E,f as F,H as g,R as y}from"./vlib-DOiUgBZ7.js";import{u as K}from"./useView-CGRdY_8C.js";import{b as h}from"./index-DVgET6nB.js";import{_ as O}from"./schedule-add-or-update.vue_vue_type_style_index_0_lang-CVwqNMiU.js";import{_ as j}from"./schedule-log.vue_vue_type_script_setup_true_lang-CmchvBB6.js";import"./quill-BosuxZz1.js";import"./lodash-DNhsom2x.js";const I={class:"mod-job__schedule"},Z=N({__name:"schedule",emits:["refreshDataList"],setup(M,{emit:A}){const _=x(),k=$({getDataListURL:"/sys/schedule/page",getDataListIsPage:!0,deleteURL:"/sys/schedule",deleteIsBatch:!0,dataForm:{beanName:""}}),e=$({...K(k),...T(k)}),C=o=>{if(!o&&e.dataListSelections&&e.dataListSelections.length<=0)return g({message:"请选择操作项",type:"warning",duration:500});y.confirm("确定进行[暂停]操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{h.put("/sys/schedule/pause",o?[o]:e.dataListSelections&&e.dataListSelections.map(t=>t.id)).then(t=>{g.success({message:"成功",duration:500,onClose:()=>{e.getDataList()}})})}).catch(()=>{})},L=o=>{if(!o&&e.dataListSelections&&e.dataListSelections.length<=0)return g({message:"请选择操作项",type:"warning",duration:500});y.confirm("确定进行[恢复]操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{h.put("/sys/schedule/resume",o?[o]:e.dataListSelections&&e.dataListSelections.map(t=>t.id)).then(t=>{g.success({message:"成功",duration:500,onClose:()=>{e.getDataList()}})})}).catch(()=>{})},v=o=>{if(!o&&e.dataListSelections&&e.dataListSelections.length<=0)return g({message:"请选择操作项",type:"warning",duration:500});y.confirm("确定进行[执行]操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{h.put("/sys/schedule/run",o?[o]:e.dataListSelections&&e.dataListSelections.map(t=>t.id)).then(t=>{g.success({message:"成功",duration:500,onClose:()=>{e.getDataList()}})})}).catch(()=>{})},D=()=>{_.value.init()},b=x(),w=o=>{b.value.init(o)};return(o,t)=>{const B=m("el-input"),c=m("el-form-item"),d=m("el-button"),H=m("el-form"),p=m("el-table-column"),S=m("el-tag"),P=m("el-table"),R=m("el-pagination"),z=V("loading");return l(),U("div",I,[n(H,{inline:!0,model:e.dataForm,onKeyup:t[8]||(t[8]=E(s=>e.getDataList(),["enter"]))},{default:a(()=>[n(c,null,{default:a(()=>[n(B,{modelValue:e.dataForm.beanName,"onUpdate:modelValue":t[0]||(t[0]=s=>e.dataForm.beanName=s),placeholder:"bean名称",clearable:""},null,8,["modelValue"])]),_:1}),n(c,null,{default:a(()=>[n(d,{onClick:t[1]||(t[1]=s=>e.getDataList())},{default:a(()=>[i("查询")]),_:1})]),_:1}),n(c,null,{default:a(()=>[e.hasPermission("sys:schedule:save")?(l(),r(d,{key:0,type:"primary",onClick:t[2]||(t[2]=s=>w())},{default:a(()=>[i("新增")]),_:1})):u("",!0)]),_:1}),n(c,null,{default:a(()=>[e.hasPermission("sys:schedule:delete")?(l(),r(d,{key:0,type:"danger",onClick:t[3]||(t[3]=s=>e.deleteHandle())},{default:a(()=>[i("删除")]),_:1})):u("",!0)]),_:1}),n(c,null,{default:a(()=>[e.hasPermission("sys:schedule:pause")?(l(),r(d,{key:0,type:"danger",onClick:t[4]||(t[4]=s=>C())},{default:a(()=>[i("暂停")]),_:1})):u("",!0)]),_:1}),n(c,null,{default:a(()=>[e.hasPermission("sys:schedule:resume")?(l(),r(d,{key:0,type:"danger",onClick:t[5]||(t[5]=s=>L())},{default:a(()=>[i("恢复")]),_:1})):u("",!0)]),_:1}),n(c,null,{default:a(()=>[e.hasPermission("sys:schedule:run")?(l(),r(d,{key:0,type:"danger",onClick:t[6]||(t[6]=s=>v())},{default:a(()=>[i("执行")]),_:1})):u("",!0)]),_:1}),n(c,null,{default:a(()=>[e.hasPermission("sys:schedule:log")?(l(),r(d,{key:0,type:"success",onClick:t[7]||(t[7]=s=>D())},{default:a(()=>[i("日志列表")]),_:1})):u("",!0)]),_:1})]),_:1},8,["model"]),F((l(),r(P,{data:e.dataList,border:"",onSelectionChange:e.dataListSelectionChangeHandle,onSortChange:e.dataListSortChangeHandle,style:{width:"100%"}},{default:a(()=>[n(p,{type:"selection","header-align":"center",align:"center",width:"50"}),n(p,{prop:"beanName",label:"bean名称","header-align":"center",align:"center"}),n(p,{prop:"params",label:"参数","show-overflow-tooltip":"","header-align":"center",align:"center"}),n(p,{prop:"cronExpression",label:"cron表达式","header-align":"center",align:"center"}),n(p,{prop:"remark",label:"备注","show-overflow-tooltip":"","header-align":"center",align:"center"}),n(p,{prop:"status",label:"状态",sortable:"custom","header-align":"center",align:"center"},{default:a(s=>[s.row.status===1?(l(),r(S,{key:0,size:"small"},{default:a(()=>[i("正常")]),_:1})):(l(),r(S,{key:1,size:"small",type:"danger"},{default:a(()=>[i("暂停")]),_:1}))]),_:1}),n(p,{label:"操作",fixed:"right","header-align":"center",align:"center",width:"248"},{default:a(s=>[e.hasPermission("sys:schedule:update")?(l(),r(d,{key:0,type:"primary",link:"",onClick:f=>w(s.row.id)},{default:a(()=>[i("修改")]),_:2},1032,["onClick"])):u("",!0),e.hasPermission("sys:schedule:pause")?(l(),r(d,{key:1,type:"primary",link:"",onClick:f=>C(s.row.id)},{default:a(()=>[i("暂停")]),_:2},1032,["onClick"])):u("",!0),e.hasPermission("sys:schedule:resume")?(l(),r(d,{key:2,type:"primary",link:"",onClick:f=>L(s.row.id)},{default:a(()=>[i("恢复")]),_:2},1032,["onClick"])):u("",!0),e.hasPermission("sys:schedule:run")?(l(),r(d,{key:3,type:"primary",link:"",onClick:f=>v(s.row.id)},{default:a(()=>[i("执行")]),_:2},1032,["onClick"])):u("",!0),e.hasPermission("sys:schedule:delete")?(l(),r(d,{key:4,type:"primary",link:"",onClick:f=>e.deleteHandle(s.row.id)},{default:a(()=>[i("删除")]),_:2},1032,["onClick"])):u("",!0)]),_:1})]),_:1},8,["data","onSelectionChange","onSortChange"])),[[z,e.dataListLoading]]),n(R,{"current-page":e.page,"page-sizes":[10,20,50,100],"page-size":e.limit,total:e.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:e.pageSizeChangeHandle,onCurrentChange:e.pageCurrentChangeHandle},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"]),n(O,{ref_key:"addOrUpdateRef",ref:b,onRefreshDataList:e.getDataList},null,8,["onRefreshDataList"]),n(j,{ref_key:"logRef",ref:_},null,512)])}}});export{Z as default};
