import{d as I,a as r,k as M,y as O,r as n,o as V,c as k,B as a,A as s,D as C,Z as P,K as R,h as j,E as Z,H as N}from"./vlib-DOiUgBZ7.js";import{u as z,b as i,_ as G}from"./index-DVgET6nB.js";import"./quill-BosuxZz1.js";import"./lodash-DNhsom2x.js";const J={class:"popover-pop-body"},Q=I({__name:"dept-add-or-update",emits:["refreshDataList"],setup(W,{expose:h,emit:L}){const c=z(),x=L,d=r(!1),p=r(),f=r([]),_=r(),v=r(),e=M({id:"",name:"",pid:"",parentName:"",sort:0}),w=O(()=>c.state.user),A=r({name:[{required:!0,message:"必填项不能为空",trigger:"blur"}],parentName:[{required:!0,message:"必填项不能为空",trigger:"change"}]}),D=o=>{d.value=!0,e.id="",p.value&&p.value.resetFields(),F().then(()=>{o?T(o):c.state.user.superAdmin===1&&u()})},F=()=>i.get("/sys/dept/list").then(o=>{if(o.code!==0)return N.error(o.msg);f.value=o.data}),T=o=>{i.get(`/sys/dept/${o}`).then(t=>{if(Object.assign(e,t.data),e.pid==="0")return u();v.value.setCurrentKey(e.pid)})},u=()=>{e.pid="0",e.parentName="一级部门"},U=o=>{e.pid=o.id,e.parentName=o.name,_.value.hide()},g=()=>{p.value.validate(o=>{if(!o)return!1;(e.id?i.put:i.post)("/sys/dept",e).then(t=>{N.success({message:"成功",duration:500,onClose:()=>{d.value=!1,x("refreshDataList")}})})})};return h({init:D}),(o,t)=>{const b=n("el-input"),m=n("el-form-item"),$=n("circle-close"),B=n("el-icon"),H=n("el-tree"),K=n("el-popover"),S=n("el-input-number"),q=n("el-form"),y=n("el-button"),E=n("el-dialog");return V(),k(E,{modelValue:d.value,"onUpdate:modelValue":t[7]||(t[7]=l=>d.value=l),title:e.id?"修改":"新增","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[s(y,{onClick:t[5]||(t[5]=l=>d.value=!1)},{default:a(()=>[C("取消")]),_:1}),s(y,{type:"primary",onClick:t[6]||(t[6]=l=>g())},{default:a(()=>[C("确定")]),_:1})]),default:a(()=>[s(q,{model:e,rules:A.value,ref_key:"dataFormRef",ref:p,onKeyup:t[4]||(t[4]=Z(l=>g(),["enter"])),"label-width":"120px"},{default:a(()=>[s(m,{prop:"name",label:"名称"},{default:a(()=>[s(b,{modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=l=>e.name=l),placeholder:"名称"},null,8,["modelValue"])]),_:1}),s(m,{prop:"parentName",label:"上级部门",class:"dept-list"},{default:a(()=>[s(K,{width:400,ref_key:"deptListPopover",ref:_,placement:"bottom-start",trigger:"click","popper-class":"popover-pop"},{reference:a(()=>[s(b,{modelValue:e.parentName,"onUpdate:modelValue":t[2]||(t[2]=l=>e.parentName=l),readonly:!0,placeholder:"上级部门"},{suffix:a(()=>[w.value.superAdmin===1&&e.pid!=="0"?(V(),k(B,{key:0,onClick:t[1]||(t[1]=P(l=>u(),["stop"])),class:"el-input__icon"},{default:a(()=>[s($)]),_:1})):R("",!0)]),_:1},8,["modelValue"])]),default:a(()=>[j("div",J,[s(H,{data:f.value,props:{label:"name",children:"children"},"node-key":"id",ref_key:"deptListTree",ref:v,"highlight-current":!0,"expand-on-click-node":!1,accordion:"",onCurrentChange:U},null,8,["data"])])]),_:1},512)]),_:1}),s(m,{prop:"sort",label:"排序"},{default:a(()=>[s(S,{modelValue:e.sort,"onUpdate:modelValue":t[3]||(t[3]=l=>e.sort=l),"controls-position":"right",min:0,label:"排序"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),oe=G(Q,[["__scopeId","data-v-dae3bdb5"]]);export{oe as default};
