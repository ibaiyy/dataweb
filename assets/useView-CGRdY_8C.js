import{u as L,b as d,a as I,q as h,g as y,e as D,E as T,f as l,h as c,r as g,j as b,k as S}from"./index-DVgET6nB.js";import{z as w,u as P,b as R,_ as k,H as u,R as q}from"./vlib-DOiUgBZ7.js";const C=p=>{const m=w(),i=P(),o=L(),e=((t,a)=>{for(const r in t)Object.getOwnPropertyDescriptor(a,r)||(a[r]=t[r]);return a})({createdIsNeed:!0,activatedIsNeed:!1,getDataListURL:"",getDataListIsPage:!1,deleteURL:"",deleteIsBatch:!1,deleteIsBatchKey:"id",exportURL:"",dataForm:{},dataList:[],order:"",orderField:"",page:1,limit:10,total:0,dataListLoading:!1,dataListSelections:[],elTable:{}},p);R(()=>{e.createdIsNeed&&!e.activatedIsNeed&&s.query()}),k(()=>{if(o.state.closedTabs.includes(o.state.activeTabName)){const t=o.state.closedTabs;o.updateState({closedTabs:t.filter(a=>a!==o.state.activeTabName)}),l.emit(c.OnReloadTabPage)}e.activatedIsNeed&&s.query()});const f={hasPermission(t){return b(o.state.permissions,t)},getDictLabel(t,a){return S(o.state.dicts,t,a)}},s={query(){e.getDataListURL&&(e.dataListLoading=!0,d.get(e.getDataListURL,{order:e.order,orderField:e.orderField,page:e.getDataListIsPage?e.page:null,limit:e.getDataListIsPage?e.limit:null,...e.dataForm}).then(t=>{e.dataListLoading=!1,e.dataList=e.getDataListIsPage?t.data.list:t.data,e.total=e.getDataListIsPage?t.data.total:0}).catch(()=>{e.dataListLoading=!1}))},dataListSelectionChangeHandle(t){e.dataListSelections=t},dataListSortChangeHandle(t){if(!t.order||!t.prop)return e.order="",e.orderField="",!1;e.order=t.order.replace(/ending$/,""),e.orderField=t.prop.replace(/([A-Z])/g,"_$1").toLowerCase(),s.query()},pageSizeChangeHandle(t){e.page=1,e.limit=t,s.query()},pageCurrentChangeHandle(t){e.page=t,s.query()},getDataList(){e.page=1,s.query()},deleteHandle(t){return new Promise((a,r)=>{if(e.deleteIsBatch&&!t&&e.dataListSelections&&e.dataListSelections.length<=0){u.warning({message:"请选择操作项",duration:500});return}q.confirm("确定进行[删除]操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{d.delete(`${e.deleteURL}${e.deleteIsBatch?"":"/"+t}`,e.deleteIsBatch?t?[t]:e.dataListSelections?e.dataListSelections.map(n=>e.deleteIsBatchKey&&n[e.deleteIsBatchKey]):{}:{}).then(n=>{u.success({message:"成功",duration:500,onClose:()=>{s.query(),a(!0)}})})}).catch(()=>{})})},exportHandle(){window.location.href=`${I.api}${e.exportURL}?${h.stringify({...e.dataForm,token:y()})}`},closeCurrentTab(){D(T.OpenTabsPage)?l.emit(c.OnCloseCurrTab):m.replace("/home")},handleFlowRoute(t){const a={path:"/flow/task-form",query:{taskId:t.taskId,processInstanceId:t.processInstanceId,processDefinitionId:t.processDefinitionId,showType:"taskHandle",_mt:`${i.meta.title} - ${t.processDefinitionName}`}};g(a)},flowDetailRoute(t){const a={path:"/flow/task-form",query:{taskId:t.taskId,processInstanceId:t.processInstanceId,processDefinitionId:t.processDefinitionId,showType:"detail",_mt:`${i.meta.title} - ${t.processDefinitionName}`}};g(a)}};return{...s,...f}},v=C;export{v as u};
